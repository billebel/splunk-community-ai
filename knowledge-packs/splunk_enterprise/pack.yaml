# Splunk Community Pack - LLM Tool Calling Optimized
# Open source architecture with logical tool groupings

metadata:
  name: "splunk_community"
  version: "1.0.0"
  description: "Open source Splunk integration optimized for modern LLM tool calling patterns"
  vendor: "Community"
  license: "MIT"
  compatibility: "^2.0.0"
  domain: "security_analytics"
  category: "SIEM"
  keywords: ["splunk", "security", "logs", "siem", "search"]
  
  # LLM optimization flags
  tool_calling_optimized: true
  modular_tools: true
  discovery_focused: true

connection:
  type: "rest"
  base_url: "{SPLUNK_URL}"
  auth:
    method: "basic"
    config:
      username: "{SPLUNK_USER}"
      password: "{SPLUNK_PASSWORD}"
  timeout: 30
  verify_ssl: false

# Core flexible search tool - LLM constructs all searches
tools:
  execute_splunk_search:
    type: "search"  
    display_name: "üîç Execute Splunk Search Query"
    description: "‚ö†Ô∏è USE AFTER GUIDED SEARCH: Run SPL queries against Splunk and return real data results. Always use 'üéØ START HERE' tool first for strategy."
    business_purpose: "Execute validated search queries after following security guidelines from guided search tool"
    key_capabilities:
      - "Execute any valid SPL search query"
      - "Return structured JSON results for LLM analysis"
      - "Support time range and result limiting"
    best_used_for:
      - "Custom searches constructed by LLM based on user intent"
      - "Targeted searches using discovered indexes, sourcetypes, and knowledge objects"
      - "Adaptive queries that leverage existing data models and event types"
    endpoint: "/services/search/jobs/oneshot"
    method: "POST"
    
    parameters:
      - name: "search_query"
        type: "string"
        required: true
        description: "Complete SPL search query to execute"
        
      - name: "earliest_time"
        type: "string"
        required: false
        default: "-1h"
        description: "Search start time"
        
      - name: "latest_time"
        type: "string"
        required: false
        default: "now"
        description: "Search end time"
        
      - name: "max_results"
        type: "integer"
        required: false
        default: 100
        min_value: 1
        max_value: 1000
        description: "Maximum events to return"
    
    form_data:
      search: "search {search_query} | table _time, _raw, index, sourcetype, source, host"
      earliest_time: "{earliest_time}"
      latest_time: "{latest_time}"
      count: "{max_results}"
      output_mode: "json"
      exec_mode: "oneshot"
    
    headers:
      Content-Type: "application/x-www-form-urlencoded"
    
    transform:
      type: "jq"
      expression: ".results"

# Modular structure
structure:
  tools:
    - "tools/data-discovery-tools.yaml"
    - "tools/guardrails-tools.yaml"
    - "tools/knowledge-objects-tools.yaml"
    - "tools/knowledge-management-tools.yaml"
    - "tools/schedule-management-tools.yaml"
    - "tools/system-info-tools.yaml"
  prompts:
    - "prompts/search-prompts.yaml"
    - "prompts/dashboard-prompts.yaml"
    - "prompts/scheduled-search-prompts.yaml"
    - "prompts/knowledge-objects-prompts.yaml"
    - "prompts/management-prompts.yaml"
    - "prompts/system-diagnostics-prompts.yaml"